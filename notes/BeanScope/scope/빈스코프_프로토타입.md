# 프로토타입 스코프

 프로토타입 스코프의 싱글톤 빈 조회 시, 스프링 컨테이너는 조회할 때마다 항상 새로운 인스턴스를 생성해서 반환한다. **요청할 때마다** 새로운 프로토타입 빈 인스턴스를 만들어 사용하고 싶은 경우에 사용하면 된다.

## 특징

* 스프링 컨테이너에 요청할 때마다 새로 생성
* 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입, 초기화까지만 관여
* 이후의 관리는 스프링 프로토타입 빈을 조회한 클라이언트가 담당(*예: 종료 메서드 호출*)

### 관리

![prototypeBean1](../../assets/prototypeBean1.png)
![prototypeBean2](../../assets/prototypeBean2.png)

1. 클라이언트가 프로토타입 스코프 스프링 빈(`prototypeBean`) 요청
2. 스프링 컨테이너는 요청 시점에 프로토타입 스코프 스프링 빈 인스턴스를 생성하고, 필요한 의존관계를 주입
   * A의 요청 → `prototypeBeanx01` 생성
   * B의 요청 → `prototypeBeanx02` 생성
   * C의 요청 → `prototypeBeanx03` 생성
3. 스프링 컨테이너는 생성, 의존관계 주입 후 클라이언트에게 반환
   * 스프링 컨테이너는 빈 생성, 의존관계 주입, 초기화(콜백 메서드)까지만 처리
   * 클라이언트에게 반환 후, 스프링 컨테이너는 해당 빈을 더 이상 관리하지 않음
4. 이후에 스프링 컨테이너에 동일한 요청이 올 때마다, 위와 같은 방식으로 새로운 프로토타입 빈을 생성해서 반환

 즉, 클라이언트는 프로토타입 스코프 빈을 요청할 때마다 다른 스프링 빈 인스턴스를 반환받게 된다. 또한, 반환된 프로토타입 스코프의 스프링 빈을 관리할 책임은 클라이언트에게 있다. 예컨대, `@PreDestroy`와 같은 메서드는 호출되지 않는다.

### 예제

 프로토타입 빈이 요청할 때마다 새로 생성되는 것임을 확인하는 테스트를 작성해 보자.
```java
public class PrototypeTest {

   @Test
   @DisplayName("프로토타입 빈 요청 시 다른 인스턴스가 반환된다.")
   public void 프로토타입_빈_테스트() {
      // given
      ConfigurableApplicationContext ac = new AnnotationConfigApplicationContext(PrototypeBean.class);

      // when
      System.out.println("PrototypeBean 요청 1");
      PrototypeBean prototypeBean1 = ac.getBean(PrototypeBean.class);
      System.out.println("PrototypeBean 요청 2");
      PrototypeBean prototypeBean2 = ac.getBean(PrototypeBean.class);

      // then
      assertThat(prototypeBean1).isNotEqualTo(prototypeBean2);
      System.out.println("prototypeBean1 = " + prototypeBean1);
      System.out.println("prototypeBean2 = " + prototypeBean2);
      
      ac.close();
   }

   @Scope("prototype")
   static class PrototypeBean {
      @PostConstruct
      public void init() {
         System.out.println("PrototypeBean.init");
      }

      @PreDestroy
      public void destroy() {
         System.out.println("PrototypeBean.destroy");
      }
   }
}
```

 실행 결과를 확인해 보자. 요청 시 인스턴스 만들어지고, 이후 만들어진 인스턴스를 반환하는 것을 알 수 있다.
* 스프링 빈 인스턴스 메모리 주소가 다름
* 초기화 메서드가 2번 호출됨
* 소멸 메서드가 호출되지 않음

```java
PrototypeBean 요청 1
PrototypeBean.init
PrototypeBean 요청 2
PrototypeBean.init
prototypeBean1 = hello.core.scope.PrototypeTest$PrototypeBean@47428937
prototypeBean2 = hello.core.scope.PrototypeTest$PrototypeBean@3b9d6699
```
