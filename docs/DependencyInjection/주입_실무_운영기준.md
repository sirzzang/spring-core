# 의존관계 주입의 올바른 실무 운영 기준

> 실무 운영에서의 의존관계 주입 시 컴포넌트 스캔을 통한 자동 주입과 설정 정보를 통한 수동 주입 중 무엇을 선택해야 할까
 
## 기본은 자동주입
스프링이 나온 뒤 시간이 지날수록 자동 주입을 선호하는 추세이다.
* 스프링은 계층에 맞춘 일반적인 어플리케이션 로직을 자동으로 스캔하여 빈으로 등록
  * `@Controller`
  * `@Service`
  * `@Repository`
* 스프링 부트도 컴포넌트 스캔을 기본으로 사용하며, 조건이 맞으면 자동으로 빈으로 등록하도록 설계됨

 개발자 입장에서도 자동 주입이 편하다.
* 어플리케이션을 구성하는 부분(설정 정보)과 실제 동작하는 부분(빈, 로직)을 나누는 것이 이상적이기는 함
* 다만, 개발 시 불편함
  * `@Component` 어노테이션 사용으로 끝날 일을, `@Configuration` 설정 정보에 가서 `@Bean`을 적고, 객체를 생성하고, 주입할 대상을 일일이 적는 과정이 번거로움
  * 관리할 빈이 많아질수록 설정 정보 관리하기가 부담
* 자동 빈 등록을 사용하더라도 OCP, DIP를 지킬 수 있음


## 수동 빈 등록이 권장되는 경우

> 어플리케이션 로직의 구분
>
> **업무 로직 빈**: 웹을 지원하는 컨트롤러, 핵심 비즈니스 로직이 있는 서비스, 데이터 계층의 로직을 처리하는 레포지토리 계층. 비즈니스 요구사항 관련 개발 시 추가되거나 변경
>
> **기술 지원 빈**: 기술적인 문제나 공통 관심사(AOP)를 처리할 때 주로 사용. 데이터베이스 연결, 공통 로그 처리 등 업무 로직을 처리하기 위한 하부 기술이나 공통 기술

### 기술 지원 로직

 기술 지원 로직의 경우, 설정 정보를 통한 수동 빈 등록을 사용하는 것이 좋다

* 업무 로직
  * 수가 많음
  * 개발 시 컨트롤러, 서비스, 리포지토리 등 유사한 패턴이 있음
  * 문제가 생겨도 어느 곳에서 찾았는지 명확하게 파악할 수 있기 때문에, 자동 등록을 사용하는 것이 좋음
* 기술 지원
  * 업무 로직과 비교했을 때, 수가 적음
  * 어플리케이션 전반에 걸쳐 광범위한 영향(*예: 공통 로그 처리*)
  * 문제 파악이 어렵기 때문에(*적용되는지 아닌지 알기조차 어려운 경우가 대부분*), 수동 빈 등록을 통해 명확하게 설정 정보를 드러내는 것을 권장

 즉, 어플리케이션에 광범위한 영향을 미치는 기술 지원 객체는 수동 빈으로 등록해서 **설정 정보에 바로 나타나게** 하는 것이 좋다.

### 다형성이 적극 활용되는 업무 로직

아래와 같은 상황의 예시를 보자. `DiscountService`가 의존관계 자동주입으로 `Map<String, DiscountPolicy>`를 주입 받는 상황이다. 

이 때, 어떤 빈들이 주입될지, 각 빈들의 이름이 무엇일지, 코드만 보고 쉽게 파악할 수 있을까? 특히, 이 코드가 내가 짠 게 아니라면?
```java
@Autowired
public DiscountService(Map<String, DiscountPolicy> policyMap, List<DiscountPolicy> policies) {
    
    this.policyMap = policyMap;
    this.policies = policies;

    System.out.println("policyMap = " + policyMap);
    System.out.println("policies = " + policies);
    
}
```
<br>

 위와 같은 경우, 설정 정보를 통해 수동으로 등록하는 것이 좋다.
* 설정 정보가 한 번에 보이므로, 빈의 이름은 물론, 어떤 빈들이 주입될지 알 수 있음
* 유지 보수가 편함
```java
@Configuration
public class DiscountPolicyConfig {
    
    @Bean
    public DiscountPolicy rateDisountPolicy() {
        return new RateDiscountPolicy();
    }
    
    @Bean
    public DiscountPolicy fixDiscountPolicy() {
        return new FixDiscountPolicy();
    }
}
```

 그래도 자동 빈 등록을 사용하고 싶다면, 최소한 구현 빈들만이라도 모아서, **특정 패키지에 같이 묶어 두는 게** 좋다.
```markdown
- src
  - main
    - java
        - hello.core
          - discount // 여기 묶여야 한다
            - FixDiscountPolicy
            - RateDiscountPolicy
```

## 예외: 스프링, 스프링 부트가 자동으로 등록하는 빈

 **스프링, 스프링 부트가 자동으로 등록하는 빈**들은 예외다. 스프링 자체를 잘 이해하고, 스프링의 의도대로 사용하는 게 좋다. 그렇지 않은 한, 그냥 두자.
* 예컨대, 스프링 부트의 `dataSource`와 같은 데이터베이스 연결에 사용되는 기술지원 로직은 스프링 부트가 자동으로 등록. 그대로 제공하는 대로 쓰자
* 만약 스프링 부트가 제공하는 것이 부족해서, 기술지원 객체를 직접 만들어서 사용할 필요가 있다면, 수동으로 등록해서 명확하게 드러내도록 하자 


# 결론
* 편리한 자동등록 기능을 기본으로 사용하자
* 직접 사용하는 기술지원 객체는 수동으로 등록하자
* 다형성을 적극적으로 활용하는 비즈니스 로직의 경우도 수동 등록을 고민해 보자

